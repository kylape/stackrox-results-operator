---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: clustersecurityresults.results.stackrox.io
spec:
  group: results.stackrox.io
  names:
    kind: ClusterSecurityResults
    listKind: ClusterSecurityResultsList
    plural: clustersecurityresults
    singular: clustersecurityresults
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.summary.nodesScanned
      name: Nodes
      type: integer
    - jsonPath: .status.summary.nodesWithCritical
      name: Critical
      type: integer
    - jsonPath: .status.summary.nodesWithHigh
      name: High
      type: integer
    - jsonPath: .status.summary.totalCVEs
      name: Total CVEs
      type: integer
    - jsonPath: .status.summary.fixableCVEs
      name: Fixable
      type: integer
    - jsonPath: .status.lastUpdated
      name: Last Updated
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          ClusterSecurityResults is the Schema for the clustersecurityresults API
          This aggregates all cluster-wide security findings into a single resource
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              ClusterSecurityResultsSpec defines the desired state of ClusterSecurityResults
              NOTE: This is a read-only resource created by the operator.
              Spec is intentionally empty - all data is in Status.
            type: object
          status:
            description: |-
              ClusterSecurityResultsStatus defines the observed state of ClusterSecurityResults
              This contains all the cluster-wide security finding data from StackRox Central
            properties:
              lastUpdated:
                description: Last update time
                format: date-time
                type: string
              nodeVulnerabilities:
                description: All node vulnerabilities in the cluster
                items:
                  description: NodeVulnerabilityData contains node vulnerability information
                  properties:
                    cves:
                      description: Top CVEs (limited)
                      items:
                        description: CVE describes a vulnerability
                        properties:
                          component:
                            description: Component describes a vulnerable software
                              component
                            properties:
                              location:
                                type: string
                              name:
                                type: string
                              version:
                                type: string
                            type: object
                          cve:
                            pattern: ^CVE-[0-9]{4}-[0-9]+$
                            type: string
                          cvss:
                            description: CVSS score (0-10)
                            type: string
                          cvssV3:
                            description: CVSSv3 contains CVSS v3 scoring
                            properties:
                              score:
                                type: string
                              vector:
                                type: string
                            required:
                            - score
                            - vector
                            type: object
                          discoveredInImage:
                            format: date-time
                            type: string
                          epss:
                            description: EPSS contains Exploit Prediction Scoring
                              System data
                            properties:
                              percentile:
                                type: string
                              score:
                                type: string
                            required:
                            - percentile
                            - score
                            type: object
                          fixable:
                            type: boolean
                          fixedBy:
                            description: Version that fixes this CVE
                            type: string
                          link:
                            type: string
                          published:
                            format: date-time
                            type: string
                          severity:
                            enum:
                            - CRITICAL
                            - HIGH
                            - MEDIUM
                            - LOW
                            type: string
                          state:
                            enum:
                            - OBSERVED
                            - DEFERRED
                            - FALSE_POSITIVE
                            type: string
                          summary:
                            type: string
                        required:
                        - cve
                        - severity
                        type: object
                        x-kubernetes-validations:
                        - rule: "true"
                      maxItems: 50
                      type: array
                    kernelVersion:
                      type: string
                    nodeName:
                      type: string
                    osImage:
                      type: string
                    scanTime:
                      format: date-time
                      type: string
                    summary:
                      description: VulnerabilitySummary summarizes vulnerabilities
                        by severity
                      properties:
                        critical:
                          description: SeverityCount counts vulnerabilities at a severity
                            level
                          properties:
                            fixable:
                              type: integer
                            total:
                              type: integer
                          required:
                          - fixable
                          - total
                          type: object
                        fixableTotal:
                          type: integer
                        high:
                          description: SeverityCount counts vulnerabilities at a severity
                            level
                          properties:
                            fixable:
                              type: integer
                            total:
                              type: integer
                          required:
                          - fixable
                          - total
                          type: object
                        low:
                          description: SeverityCount counts vulnerabilities at a severity
                            level
                          properties:
                            fixable:
                              type: integer
                            total:
                              type: integer
                          required:
                          - fixable
                          - total
                          type: object
                        medium:
                          description: SeverityCount counts vulnerabilities at a severity
                            level
                          properties:
                            fixable:
                              type: integer
                            total:
                              type: integer
                          required:
                          - fixable
                          - total
                          type: object
                        total:
                          type: integer
                      required:
                      - fixableTotal
                      - total
                      type: object
                  required:
                  - nodeName
                  - osImage
                  - scanTime
                  - summary
                  type: object
                type: array
              summary:
                description: Summary counts across all nodes
                properties:
                  fixableCVEs:
                    description: Fixable CVEs across all nodes
                    type: integer
                  nodesScanned:
                    description: Number of nodes scanned
                    type: integer
                  nodesWithCritical:
                    description: Nodes with critical vulnerabilities
                    type: integer
                  nodesWithHigh:
                    description: Nodes with high vulnerabilities
                    type: integer
                  totalCVEs:
                    description: Total CVEs across all nodes
                    type: integer
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
